<!-- Loading State -->
<div *ngIf="isLoading" class="min-h-screen bg-gray-50 py-12 animate-fadeInUp">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      <div class="space-y-4">
        <div class="bg-gray-200 h-[600px] rounded-3xl animate-pulse"></div>
        <div class="grid grid-cols-5 gap-4">
          <div *ngFor="let i of [1,2,3,4,5]" class="bg-gray-200 h-20 rounded-2xl animate-pulse"></div>
        </div>
      </div>
      <div class="space-y-6">
        <div class="h-8 bg-gray-200 rounded w-3/4 animate-pulse"></div>
        <div class="h-4 bg-gray-200 rounded w-1/2 animate-pulse"></div>
        <div class="h-32 bg-gray-200 rounded animate-pulse"></div>
      </div>
    </div>
  </div>
</div>

<!-- Product Detail -->
<div *ngIf="!isLoading && product" class="min-h-screen bg-white animate-fadeInUp">
  
  <!-- Breadcrumb -->
  <div class="border-b border-gray-200 bg-gray-50">
    <div class="container mx-auto px-4 py-4">
      <nav class="flex items-center space-x-2 text-sm">
        <a routerLink="/" class="text-gray-600 hover:text-black transition-colors">Accueil</a>
        <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <a routerLink="/products" class="text-gray-600 hover:text-black transition-colors">Produits</a>
        <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <span *ngIf="product.category" class="text-gray-600">{{ product.category.name }}</span>
        <svg *ngIf="product.category" class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <span class="text-gray-900 font-medium">{{ product.name }}</span>
      </nav>
    </div>
  </div>

  <div class="container mx-auto px-4 py-12">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 md:gap-12 lg:gap-16">
      
      <!-- Image Gallery -->
      <div class="space-y-3 sm:space-y-4">
        <!-- Main Image -->
        <div class="relative aspect-square rounded-2xl sm:rounded-3xl overflow-hidden bg-gray-100 group">
          <img 
            [src]="getProductImage(product, selectedImage)" 
            [alt]="product.name" 
            class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
          />
          
          <!-- Badges -->
          <div class="absolute top-2 sm:top-4 left-2 sm:left-4 flex flex-col gap-1.5 sm:gap-2">
            <span *ngIf="product.isNewArrival" class="px-2.5 sm:px-4 py-1 sm:py-2 rounded-full bg-green-500 text-white text-xs sm:text-sm font-bold shadow-lg">
              Nouveau
            </span>
            <span *ngIf="product.isBestSeller" class="px-2.5 sm:px-4 py-1 sm:py-2 rounded-full bg-purple-500 text-white text-xs sm:text-sm font-bold shadow-lg">
              Best Seller
            </span>
            <span *ngIf="product.compareAtPrice && product.compareAtPrice > product.price" 
                  class="px-2.5 sm:px-4 py-1 sm:py-2 rounded-full bg-red-500 text-white text-xs sm:text-sm font-bold shadow-lg">
              -{{ getDiscountPercentage() }}%
            </span>
          </div>

          <!-- Wishlist Button -->
          <button 
            (click)="toggleWishlist()"
            class="absolute top-2 sm:top-4 right-2 sm:right-4 h-10 w-10 sm:h-12 sm:w-12 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center shadow-lg hover:bg-red-50 active:bg-red-100 transition-all duration-200 group/wish touch-manipulation">
            <svg class="h-5 w-5 sm:h-6 sm:w-6 transition-colors" 
                 [class.text-red-500]="isInWishlist"
                 [class.fill-current]="isInWishlist"
                 [class.text-gray-600]="!isInWishlist"
                 fill="none" 
                 stroke="currentColor" 
                 viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
          </button>

          <!-- Navigation Arrows -->
          <button 
            *ngIf="product.images.length > 1"
            (click)="previousImage()"
            class="absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 h-8 w-8 sm:h-10 sm:w-10 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center shadow-lg hover:bg-gray-100 active:bg-gray-200 transition-all opacity-0 group-hover:opacity-100 sm:opacity-100 touch-manipulation">
            <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          <button 
            *ngIf="product.images.length > 1"
            (click)="nextImage()"
            class="absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 h-8 w-8 sm:h-10 sm:w-10 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center shadow-lg hover:bg-gray-100 active:bg-gray-200 transition-all opacity-0 group-hover:opacity-100 sm:opacity-100 touch-manipulation">
            <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
        
        <!-- Thumbnails -->
        <div class="grid grid-cols-4 sm:grid-cols-5 gap-2 sm:gap-3" *ngIf="product.images.length > 1">
          <button 
            *ngFor="let image of product.images; let i = index"
            (click)="selectImage(i)"
            [class.ring-2]="selectedImage === i"
            [class.ring-black]="selectedImage === i"
            class="aspect-square rounded-lg sm:rounded-2xl overflow-hidden bg-gray-100 hover:opacity-75 active:opacity-60 transition-all cursor-pointer touch-manipulation"
          >
            <img [src]="image.url" [alt]="image.alt" class="h-full w-full object-cover">
          </button>
        </div>
      </div>

      <!-- Product Info -->
      <div class="space-y-4 sm:space-y-6 md:space-y-8">
        
        <!-- Title & Rating -->
        <div>
          <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-3 sm:mb-4">{{ product.name }}</h1>
          
          <!-- Rating & Reviews -->
          <div class="flex items-center gap-2 sm:gap-4 mb-3 sm:mb-4">
            <div class="flex items-center">
              <svg *ngFor="let star of [1,2,3,4,5]" 
                   [class.text-yellow-400]="star <= Math.floor(product.rating || 0)"
                   [class.text-gray-300]="star > Math.floor(product.rating || 0)"
                   class="h-4 w-4 sm:h-5 sm:w-5 fill-current" 
                   viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
            </div>
            <span class="text-sm sm:text-base text-gray-600 font-medium">{{ product.rating || 0 }} ({{ product.reviewCount || 0 }} avis)</span>
          </div>

          <!-- Short Description -->
          <p class="text-sm sm:text-base md:text-lg text-gray-600 leading-relaxed">{{ product.shortDescription }}</p>
        </div>

        <!-- Price -->
        <div class="pb-4 sm:pb-6 border-b border-gray-200">
          <div class="flex items-baseline gap-2 sm:gap-4">
            <span class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900">{{ currencyService.formatPrice(product.price) }}</span>
            <span *ngIf="product.compareAtPrice && product.compareAtPrice > product.price" 
                  class="text-lg sm:text-xl md:text-2xl text-gray-400 line-through">
              {{ currencyService.formatPrice(product.compareAtPrice) }}
            </span>
          </div>
          <p *ngIf="product.compareAtPrice && product.compareAtPrice > product.price" 
             class="text-xs sm:text-sm text-green-600 font-medium mt-2">
            Vous économisez {{ currencyService.formatPrice(product.compareAtPrice - product.price) }} ({{ getDiscountPercentage() }}%)
          </p>
        </div>

        <!-- Stock & SKU Info -->
        <div class="space-y-3 pb-6 border-b border-gray-200">
          <!-- Stock Status -->
          <div class="flex items-center justify-between">
            <span class="text-gray-600 font-medium">Disponibilité:</span>
            <div class="flex items-center space-x-2">
              <span *ngIf="product.stock > 10" class="flex items-center text-green-600 font-medium">
                <span class="h-2 w-2 rounded-full bg-green-500 mr-2"></span>
                En stock ({{ product.stock }})
              </span>
              <span *ngIf="product.stock <= 10 && product.stock > 0" class="flex items-center text-orange-600 font-medium">
                <span class="h-2 w-2 rounded-full bg-orange-500 mr-2 animate-pulse"></span>
                Plus que {{ product.stock }} en stock
              </span>
              <span *ngIf="product.stock === 0" class="flex items-center text-red-600 font-medium">
                <span class="h-2 w-2 rounded-full bg-red-500 mr-2"></span>
                Rupture de stock
              </span>
            </div>
          </div>

          <!-- SKU -->
          <div class="flex items-center justify-between">
            <span class="text-gray-600 font-medium">SKU:</span>
            <span class="font-mono text-sm bg-gray-100 px-3 py-1 rounded-lg">{{ product.sku }}</span>
          </div>

          <!-- Brand -->
          <div *ngIf="product.brand" class="flex items-center justify-between">
            <span class="text-gray-600 font-medium">Marque:</span>
            <span class="font-medium text-gray-900">{{ product.brand }}</span>
          </div>

          <!-- Category -->
          <div *ngIf="product.category" class="flex items-center justify-between">
            <span class="text-gray-600 font-medium">Catégorie:</span>
            <a [routerLink]="['/products']" [queryParams]="{category: product.categoryId}" 
               class="font-medium text-purple-600 hover:text-purple-700 transition-colors">
              {{ product.category.name }}
            </a>
          </div>

          <!-- Tags -->
          <div *ngIf="product.tags && product.tags.length > 0" class="flex items-start justify-between">
            <span class="text-gray-600 font-medium">Tags:</span>
            <div class="flex flex-wrap gap-2 justify-end">
              <span *ngFor="let tag of product.tags" 
                    class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full">
                {{ tag }}
              </span>
            </div>
          </div>
        </div>

        <!-- Quantity Selector -->
        <div>
          <label class="block text-sm font-medium text-gray-900 mb-2 sm:mb-3">Quantité</label>
          <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4">
            <div class="inline-flex items-center border-2 border-gray-300 rounded-lg sm:rounded-xl overflow-hidden w-full sm:w-auto">
              <button 
                (click)="decreaseQuantity()"
                [disabled]="quantity <= 1"
                class="px-4 sm:px-5 py-2 sm:py-3 hover:bg-gray-100 active:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation flex-1 sm:flex-none">
                <svg class="h-4 w-4 sm:h-5 sm:w-5 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                </svg>
              </button>
              <span class="px-6 sm:px-8 py-2 sm:py-3 font-bold text-base sm:text-lg border-x-2 border-gray-300 text-center min-w-[80px] sm:min-w-0">{{ quantity }}</span>
              <button 
                (click)="increaseQuantity()"
                [disabled]="quantity >= product.stock"
                class="px-4 sm:px-5 py-2 sm:py-3 hover:bg-gray-100 active:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation flex-1 sm:flex-none">
                <svg class="h-4 w-4 sm:h-5 sm:w-5 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
              </button>
            </div>
            <span class="text-sm sm:text-base text-gray-600">{{ quantity * product.price | currency:'EUR' }} total</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="space-y-2.5 sm:space-y-3">
          <button 
            (click)="addToCart()"
            [disabled]="product.stock === 0"
            class="w-full flex items-center justify-center gap-2 sm:gap-3 px-6 sm:px-8 py-3 sm:py-4 bg-black text-white rounded-full hover:bg-gray-800 active:bg-gray-900 transition-all duration-200 font-semibold text-base sm:text-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-black shadow-lg hover:shadow-xl touch-manipulation">
            <svg class="h-5 w-5 sm:h-6 sm:w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
            </svg>
            <span>{{ product.stock === 0 ? 'Rupture de stock' : 'Ajouter au panier' }}</span>
          </button>

          <button 
            (click)="buyNow()"
            [disabled]="product.stock === 0"
            class="w-full flex items-center justify-center gap-2 sm:gap-3 px-6 sm:px-8 py-3 sm:py-4 border-2 border-black text-black rounded-full hover:bg-gray-50 active:bg-gray-100 transition-all duration-200 font-semibold text-base sm:text-lg disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation">
            <svg class="h-5 w-5 sm:h-6 sm:w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            <span>Acheter maintenant</span>
          </button>
        </div>

        <!-- Trust Badges -->
        <div class="grid grid-cols-3 gap-4 pt-6 border-t border-gray-200">
          <div class="text-center">
            <div class="h-12 w-12 mx-auto mb-2 rounded-full bg-green-100 flex items-center justify-center">
              <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <p class="text-xs font-medium text-gray-900">Livraison rapide</p>
            <p class="text-xs text-gray-500">2-3 jours</p>
          </div>
          <div class="text-center">
            <div class="h-12 w-12 mx-auto mb-2 rounded-full bg-blue-100 flex items-center justify-center">
              <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
              </svg>
            </div>
            <p class="text-xs font-medium text-gray-900">Paiement sécurisé</p>
            <p class="text-xs text-gray-500">SSL/TLS</p>
          </div>
          <div class="text-center">
            <div class="h-12 w-12 mx-auto mb-2 rounded-full bg-purple-100 flex items-center justify-center">
              <svg class="h-6 w-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
            </div>
            <p class="text-xs font-medium text-gray-900">Retours gratuits</p>
            <p class="text-xs text-gray-500">30 jours</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs Section -->
    <div class="mt-8 sm:mt-12 md:mt-16">
      <div class="border-b border-gray-200 overflow-x-auto">
        <div class="flex gap-4 sm:gap-6 md:gap-8 min-w-max px-4 sm:px-0">
          <button 
            *ngFor="let tab of tabs" 
            (click)="activeTab = tab.id"
            [class.border-black]="activeTab === tab.id"
            [class.text-gray-900]="activeTab === tab.id"
            [class.border-transparent]="activeTab !== tab.id"
            [class.text-gray-600]="activeTab !== tab.id"
            class="pb-3 sm:pb-4 border-b-2 font-semibold text-sm sm:text-base transition-colors hover:text-gray-900 whitespace-nowrap touch-manipulation">
            {{ tab.label }}
          </button>
        </div>
      </div>

      <!-- Tab Content -->
      <div class="py-8">
        
        <!-- Description Tab -->
        <div *ngIf="activeTab === 'description'" class="prose max-w-none">
          <div class="text-gray-700 leading-relaxed whitespace-pre-line">{{ product.description }}</div>
        </div>

        <!-- Specifications Tab -->
        <div *ngIf="activeTab === 'specifications'">
          <div *ngIf="product.specifications && Object.keys(product.specifications).length > 0" 
               class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div *ngFor="let spec of product.specifications | keyvalue" 
                 class="flex items-center justify-between p-4 rounded-xl border border-gray-200 hover:border-gray-300 transition-colors">
              <span class="font-medium text-gray-700">{{ spec.key }}</span>
              <span class="text-gray-900 font-semibold">{{ spec.value }}</span>
            </div>
          </div>
          <div *ngIf="!product.specifications || Object.keys(product.specifications).length === 0" 
               class="text-center py-12 text-gray-500">
            Aucune spécification disponible
          </div>
        </div>

        <!-- Reviews Tab -->
        <div *ngIf="activeTab === 'reviews'" class="space-y-8">
          
          <!-- Reviews Summary -->
          <div *ngIf="reviewStats && reviewStats.totalReviews > 0" class="bg-gray-50 rounded-2xl p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <!-- Average Rating -->
              <div class="text-center">
                <div class="text-6xl font-bold text-gray-900 mb-2">{{ reviewStats.averageRating | number:'1.1-1' }}</div>
                <div class="flex items-center justify-center mb-2">
                  <svg *ngFor="let star of getRatingArray(Math.round(reviewStats.averageRating))" 
                       class="w-6 h-6 text-yellow-400 fill-current" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                  </svg>
                </div>
                <p class="text-gray-600">{{ reviewStats.totalReviews }} avis</p>
                <p class="text-sm text-gray-500 mt-1">{{ reviewStats.verifiedPurchasePercentage | number:'1.0-0' }}% d'achats vérifiés</p>
              </div>

              <!-- Rating Distribution -->
              <div class="space-y-2">
                <div *ngFor="let rating of [5,4,3,2,1]" class="flex items-center space-x-3">
                  <span class="text-sm text-gray-600 w-8">{{ rating }} ★</span>
                  <div class="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-yellow-400" [style.width.%]="getRatingPercentage(rating)"></div>
                  </div>
                  <span class="text-sm text-gray-600 w-12">{{ reviewStats.ratingDistribution[rating] || 0 }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Write Review Button -->
          <div class="flex justify-between items-center">
            <h3 class="text-2xl font-bold text-gray-900">Avis clients</h3>
            <button 
              *ngIf="canReview"
              (click)="toggleReviewForm()"
              class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-colors"
            >
              {{ showReviewForm ? 'Annuler' : 'Écrire un avis' }}
            </button>
            <div *ngIf="!canReview && !authService.currentUser" class="text-gray-600">
              <a routerLink="/auth/login" class="text-indigo-600 hover:underline">Connectez-vous</a> pour laisser un avis
            </div>
          </div>

          <!-- Review Form -->
          <div *ngIf="showReviewForm" class="bg-white border-2 border-indigo-200 rounded-2xl p-8">
            <h4 class="text-xl font-bold text-gray-900 mb-6">Votre avis</h4>
            <form (ngSubmit)="submitReview()" class="space-y-6">
              <!-- Rating -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Note *</label>
                <div class="flex items-center space-x-2">
                  <button
                    *ngFor="let star of [1,2,3,4,5]"
                    type="button"
                    (click)="reviewFormData.rating = star"
                    class="focus:outline-none"
                  >
                    <svg [class.text-yellow-400]="star <= reviewFormData.rating" 
                         [class.text-gray-300]="star > reviewFormData.rating"
                         class="w-10 h-10 fill-current transition-colors hover:scale-110" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                    </svg>
                  </button>
                </div>
              </div>

              <!-- Title -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Titre *</label>
                <input
                  type="text"
                  [(ngModel)]="reviewFormData.title"
                  name="title"
                  required
                  placeholder="Résumez votre expérience"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
              </div>

              <!-- Comment -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Commentaire *</label>
                <textarea
                  [(ngModel)]="reviewFormData.comment"
                  name="comment"
                  required
                  rows="5"
                  placeholder="Partagez votre avis sur ce produit..."
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                ></textarea>
              </div>

              <!-- Submit -->
              <button
                type="submit"
                class="w-full px-6 py-4 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-colors"
              >
                Publier mon avis
              </button>
            </form>
          </div>

          <!-- Reviews List -->
          <div *ngIf="reviews.length > 0" class="space-y-6">
            <div *ngFor="let review of reviews" class="bg-white border border-gray-200 rounded-2xl p-8">
              <div class="flex items-start justify-between mb-4">
                <div class="flex items-center space-x-4">
                  <div class="h-12 w-12 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold">
                    {{ review.userName[0] || 'A' }}
                  </div>
                  <div>
                    <h4 class="font-bold text-gray-900">{{ review.userName }}</h4>
                    <div class="flex items-center space-x-2">
                      <div class="flex items-center">
                        <svg *ngFor="let star of getRatingArray(review.rating)" 
                             class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                      </div>
                      <span *ngIf="review.verifiedPurchase" class="text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full">
                        ✓ Achat vérifié
                      </span>
                    </div>
                  </div>
                </div>
                <span class="text-sm text-gray-500">{{ review.createdAt | date:'dd/MM/yyyy' }}</span>
              </div>
              <h5 class="font-bold text-gray-900 mb-2">{{ review.title }}</h5>
              <p class="text-gray-700 leading-relaxed">{{ review.comment }}</p>
            </div>
          </div>

          <!-- No Reviews -->
          <div *ngIf="reviews.length === 0" class="text-center py-12 bg-gray-50 rounded-2xl">
            <div class="h-16 w-16 mx-auto mb-4 rounded-full bg-gray-200 flex items-center justify-center">
              <svg class="h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Aucun avis pour le moment</h3>
            <p class="text-gray-600 mb-4">Soyez le premier à laisser un avis sur ce produit</p>
            <button 
              *ngIf="canReview"
              (click)="toggleReviewForm()"
              class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-colors inline-block"
            >
              Écrire le premier avis
            </button>
          </div>
        </div>

        <!-- Shipping Tab -->
        <div *ngIf="activeTab === 'shipping'" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="p-6 rounded-2xl border border-gray-200">
              <h3 class="font-bold text-gray-900 mb-3 flex items-center">
                <svg class="h-5 w-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Livraison standard
              </h3>
              <p class="text-gray-600 text-sm mb-2">Gratuite à partir de 50€</p>
              <p class="text-gray-900 font-semibold">2-3 jours ouvrables</p>
            </div>
            <div class="p-6 rounded-2xl border border-gray-200">
              <h3 class="font-bold text-gray-900 mb-3 flex items-center">
                <svg class="h-5 w-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Livraison express
              </h3>
              <p class="text-gray-600 text-sm mb-2">+9.99€</p>
              <p class="text-gray-900 font-semibold">24-48 heures</p>
            </div>
          </div>
          <div class="p-6 rounded-2xl bg-blue-50 border border-blue-200">
            <h3 class="font-bold text-blue-900 mb-2">Politique de retour</h3>
            <p class="text-blue-800 text-sm">Retours gratuits sous 30 jours. Le produit doit être dans son état d'origine avec tous les accessoires et l'emballage.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Related Products -->
    <div *ngIf="relatedProducts.length > 0" class="mt-16">
      <h2 class="text-3xl font-bold text-gray-900 mb-8">Produits similaires</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <a *ngFor="let relatedProduct of relatedProducts" 
           [routerLink]="['/products', relatedProduct.slug]"
           class="group block">
          <div class="bg-white rounded-3xl border border-gray-200 shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden">
            <div class="relative aspect-square overflow-hidden bg-gray-100">
              <img 
                [src]="getProductImage(relatedProduct)" 
                [alt]="relatedProduct.name" 
                class="h-full w-full object-cover group-hover:scale-110 transition-transform duration-500"
              />
            </div>
            <div class="p-6">
              <h3 class="font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-purple-600 transition-colors">
                {{ relatedProduct.name }}
              </h3>
              <div class="flex items-baseline space-x-2">
                <span class="text-xl font-bold text-gray-900">{{ relatedProduct.price | currency:'EUR' }}</span>
                <span *ngIf="relatedProduct.compareAtPrice && relatedProduct.compareAtPrice > relatedProduct.price" 
                      class="text-sm text-gray-500 line-through">
                  {{ relatedProduct.compareAtPrice | currency:'EUR' }}
                </span>
              </div>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Product Not Found -->
<div *ngIf="!isLoading && !product" class="min-h-screen bg-gray-50 flex items-center justify-center">
  <div class="text-center">
    <div class="h-24 w-24 mx-auto mb-6 rounded-full bg-gray-200 flex items-center justify-center">
      <svg class="h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </div>
    <h2 class="text-3xl font-bold text-gray-900 mb-4">Produit non trouvé</h2>
    <p class="text-gray-600 mb-8">Désolé, ce produit n'existe pas ou a été supprimé.</p>
    <a routerLink="/products" 
       class="inline-flex items-center space-x-2 px-8 py-4 bg-black text-white rounded-full hover:bg-gray-800 transition-colors font-medium">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      <span>Retour au catalogue</span>
    </a>
  </div>
</div>
